!function(e){"use strict";"object"==typeof module&&module.exports?module.exports=e(window):"function"==typeof define&&define.amd?define([],function(){return"undefined"==typeof window?{vdom:{}}:e(window)}):window.cito=e(window)}(function(e,t){"use strict";function n(e){return"string"==typeof e}function r(e){return e instanceof Array}function i(e){return"function"==typeof e}function o(e,n){var r=typeof e;return"string"===r?e={tag:"#",children:e}:"function"===r&&(e=e(n),e=e===t?n:o(e,n)),e}function a(e,t,n){var r=o(t,n);return t!==r&&e&&(e.children=r),r}function l(e,t,n){var r=a(null,s(e,t));return r.dom||(r.dom=n.firstChild,"<"===r.tag&&(r.domLength=n.childNodes.length)),r}function f(e,t,n){var r=e[t],i=o(r,n);return r!==i&&(e[t]=i),i}function d(e,n,r){return i(n)&&(n=n(r,e),n===t&&(n=r),e.children=n),n}function s(e,t){return 1===t?e[0]:e}function u(e,t,n){var r,i=t.dom,o=t.domLength||1,a=n&&n.dom;if(i!==a)for(;o--;)r=o>0?i.nextSibling:null,a?e.insertBefore(i,a):e.appendChild(i),i=r}function c(){return te.createTextNode("")}function v(e,t,n){if(e.insertAdjacentHTML){var r,i,o;if(Y||Z){var a="beforebegin"===t?e.previousSibling:"beforeend"===t?e.lastChild:null;a&&3===a.nodeType&&(r=a,Z&&0===a.length&&(o=!0,a.nodeValue=" "),Y&&(i=a.length))}e.insertAdjacentHTML(t,n),r&&(Y&&r.length!==i&&r.splitText(i),Z&&o&&(r.nodeValue=""))}else if(de.innerHTML=n,"beforebegin"===t)for(var l=e.parentNode;de.firstChild;)l.insertBefore(de.firstChild,e);else if("beforeend"===t)for(;de.firstChild;)e.appendChild(de.firstChild)}function h(e,t,n,r){if(n){var i=n.dom;if(r){var o=n.domLength||1;1===o?(G(n),e.replaceChild(t,i)):(e.insertBefore(t,i),I(e,n))}else e.insertBefore(t,i)}else e.appendChild(t)}function g(e,n,r,i,o,a){if(fe)return p(e,n,i,o);var l,f=e.tag,d=e.children;switch(f){case t:return L(e,d,n,r,i,o);case"#":if(a)return void O(n,d);l=te.createTextNode(d);break;case"!":l=te.createComment(d);break;case"<":if(d){if(a)n.innerHTML=d;else{var s=n.childNodes,u=s.length;if(i){var g=i.dom,b=g.previousSibling;v(g,"beforebegin",d),l=b?b.nextSibling:n.firstChild}else v(n,"beforeend",d),l=s[u];e.dom=l,e.domLength=s.length-u,o&&i&&I(n,i)}return}l=c();break;default:var x;switch(f){case"svg":x="http://www.w3.org/2000/svg";break;case"math":x="http://www.w3.org/1998/Math/MathML";break;default:x=r}var y=e.attrs,C=y&&y.is;x?(e.ns=x,l=C?te.createElementNS(x,f,C):te.createElementNS(x,f)):l=C?te.createElement(f,C):te.createElement(f),e.dom=l,fe&&n&&h(n,l,i,o),"string"==typeof d?O(l,d,!1):A(l,e,x,d,!1),y&&T(l,f,x,y);var k=e.events;k&&S(l,e,k),!fe&&n&&h(n,l,i,o);var w=k&&k.$created;return void(w&&m(w,"$created",l,e))}e.dom=l,n&&h(n,l,i,o)}function m(e,t,n,i,o,a){var l={type:t,target:n,virtualNode:i};if(o&&(l[o]=a),r(e)){for(var f=0;f<e.length;f++)if(e[f].call(n,l)===!1)return}else e.call(n,l)}function p(e,t,n,r){var i,o=b(e);if(t){var a;n||t.hasChildNodes()?(n?(a=n.dom.previousSibling,v(n.dom,"beforebegin",o),r&&I(t,n)):(a=t.lastChild,v(t,"beforeend",o)),i=a?a.nextSibling:t.firstChild):(t.innerHTML=o,i=t.firstChild)}else de.innerHTML=o,i=de.removeChild(de.firstChild);x(i,e)}function b(e,r){var i=e.tag,o=e.children;switch(i){case"#":return C(o)+me;case"!":return"<!--"+k(o)+"-->";case"<":return o+me;default:var l;if(i){var u=e.attrs;if("select"===i&&u?r={selectedIndex:u.selectedIndex,value:u.value,optionIndex:0}:"option"===i&&r&&((r.value&&r.value===u.value||r.selectedIndex!==t&&r.selectedIndex===r.optionIndex)&&(u.selected=!0),r.optionIndex++),l="<"+i,u){l+=" ";for(var c in u){var v=u[c];if(v!==!1&&("select"!==i||"value"!==c&&"selectedIndex"!==c))if("textarea"!==i||"value"!==c){if(v===!0)v="";else if("style"===c&&!n(v)){var h="";for(var g in v)h+=g+": "+v[g]+"; ";v=h}l+=" "+w(c,v)}else o=v}}}else l="";i&&(l+=">"),o=d(e,o);var m=V(o);if(m>1)for(var p=0,x=o.length;p<x;p++)l+=b(f(o,p),r);else if(0!==m){var y=s(o,m);n(y)?(l+=C(y),i&&y||(l+=me)):l+=b(a(e,y),r)}else i||(l+=me);return i&&(l+="</"+i+">"),l}}function x(e,t){var r=t.tag;if(r){t.dom=e;var i,o;switch(r){case"#":i=e.nodeValue,o=i.indexOf(me),o!==-1&&(o+1<i.length&&e.splitText(o+1),e.nodeValue=i.substr(0,o));break;case"!":break;case"<":for(var a,l=0;e;e=e.nextSibling)if(l++,3===e.nodeType){if(i=e.nodeValue,l>1&&i===me){a=e.nextSibling,e.parentNode.removeChild(e),l--;break}if(o=i.indexOf(me),o!==-1){o+1<i.length&&e.splitText(o+1),e.nodeValue=i.substr(0,o),a=e.nextSibling;break}}return t.domLength=l,a;default:var f=t.children,d=V(f);if(d>1){f=t.children;for(var u=e.firstChild,c=0,v=f.length;c<v;c++)u=x(u,f[c])}else if(0!==d){var h=s(f,d);n(h)?h||(e.firstChild.nodeValue=""):x(e.firstChild,h)}var g=t.events;if(g){S(e,t,g);var p=g.$created;p&&m(p,"$created",e,t)}}return e.nextSibling}return y(e,t)}function y(e,t){var n,r=t.children,i=V(r);if(0===i)e.length>1&&e.splitText(1),e.nodeValue="",t.dom=e,n=e.nextSibling;else{if(i>1){n=e;for(var o=0;o<r.length;o++)n=x(n,r[o]);e=r[0].dom}else{var l=a(t,s(r,i));n=x(e,l),e=l.dom}t.dom=e;for(var f=0;e!==n;)f++,e=e.nextSibling;t.domLength=f}return n}function C(e){return e=""+e,ae?(de.innerText=e,e=de.innerHTML):e=le?e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;"):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e}function k(e){return e=""+e,e.replace(/-{2,}/g,"-")}function w(e,t){var n=typeof t;return t=""+t,"number"!==n&&(t=le?t.split("&").join("&amp;").split('"').join("&quot;"):t.replace(/&/g,"&amp;").replace(/"/g,"&quot;")),e+'="'+t+'"'}function L(e,t,n,r,i,o){t=d(e,t);var l,u,v,m=V(t);if(r&&(e.ns=r),0===m)l=c(),h(n,l,i,o);else if(m>1){u=0;for(var p=0,b=t.length;p<b;p++)v=f(t,p),g(v,n,r,i,!1),u+=v.domLength||1;l=t[0].dom,o&&I(n,i)}else v=a(e,s(t,m)),g(v,n,r,i,o),l=v.dom,u=v.domLength;e.dom=l,e.domLength=u}function T(e,n,r,i,o,a){var l,f;if(i)for(f in i){var d=!1,s=i[f];if("style"===f){var u=o&&o[f];u!==s&&(d=E(e,u,i,s))}else M(n,f)?e[f]!==s&&(e[f]=s,d=!0):o&&o[f]===s||("class"!==f||r?N(e,f,s):e.className=s,d=!0);d&&a&&(l||(l=[])).push(f)}if(o)for(f in o)i&&i[f]!==t||("class"!==f||r?M(n,f)||e.removeAttribute(f):e.className="",a&&(l||(l=[])).push(f));return l}function N(e,t,n){if(n===!1)e.removeAttribute(t);else{n===!0&&(n="");var r,i=t.indexOf(":");if(i!==-1){var o=t.substr(0,i);switch(o){case"xlink":r="http://www.w3.org/1999/xlink"}}r?e.setAttributeNS(r,t,n):e.setAttribute(t,n)}}function E(e,r,i,o){var a,l=!1;if(!n(o)&&(!ve||!r||n(r))){var f="";if(o)for(a in o)f+=a+": "+o[a]+"; ";o=f,ve||(i.style=o)}var d=e.style;if(n(o))d.cssText=o,l=!0;else{if(o)for(a in o){var s=o[a];if(!r||r[a]!==s){var u=s.indexOf("!important");if(u!==-1)d.setProperty(a,s.substr(0,u),"important");else{if(r){var c=r[a];c&&c.indexOf("!important")!==-1&&d.removeProperty(a)}d.setProperty(a,s,"")}l=!0}}if(r)for(a in r)o&&o[a]!==t||(d.removeProperty(a),l=!0)}return l}function S(e,t,n,r){var i;if(n){e.virtualNode=t;for(i in n)r&&r[i]||$(e,i)}if(r)for(i in r)n&&n[i]||P(e,i)}function M(e,t){switch(e){case"input":return"value"===t||"checked"===t;case"textarea":return"value"===t;case"select":return"value"===t||"selectedIndex"===t;case"option":return"selected"===t}}function $(e,t){if("$"!==t[0])if(ue)e.addEventListener(t,B,!1);else{var n="on"+t;n in e?e[n]=B:e.attachEvent(n,B)}}function P(e,t){if("$"!==t[0])if(ue)e.removeEventListener(t,B,!1);else{var n="on"+t;n in e?e[n]=null:e.detachEvent(n,B)}}function A(e,t,r,i,o){i=d(t,i);var l=V(i);if(l>1)for(var u=0,c=i.length;u<c;u++)g(f(i,u),e,r);else if(0!==l){var v=s(i,l);!o&&n(v)?O(e,v):(v=a(t,v),g(v,e,r,null,!1,!o))}}function V(e){return r(e)?e.length:e||n(e)?-1:0}function j(e,t,r){r>1?H(e,t,0,t.length):0!==r&&(n(t)?e.removeChild(e.firstChild):I(e,l(t,r,e)))}function H(e,t,n,r){for(;n<r;n++)I(e,t[n])}function I(e,t){G(t);for(var n,r=t.dom,i=t.domLength||1;i--;)n=i>0?r.nextSibling:null,e.removeChild(r),r=n}function O(e,t,n){if(t)se?e.textContent=t:e.innerText=t;else{if(n)for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(c())}}function D(e,t,r,i,o,c,v){if(o=d(t,o,i),o!==i){var h=V(i);if(0===h)return void A(e,t,r,o,!1);var m,p,b=V(o);if(0===b)return void j(e,i,h);if(b<2){if(p=s(o,b),!c&&n(p)){if(b===h){if(m=s(i,h),p===m)return;if(n(m))return void(e.firstChild.nodeValue=p)}return J(i,h),void O(e,p,!0)}if(h<2)return m=l(i,h,e),p=a(t,p,m),void W(m,p,e,r,null,0,v,!c)}b===-1&&(t.children=o=[o]),h<2&&(m=l(i,h,e),1===h?i[0]=m:i=[m]);var x,y=i.length,C=o.length,k=y-1,w=o.length-1,L=0,T=0,N=!0;e:for(;N&&L<=k&&T<=w;){N=!1;var E,S,M,$;for(E=i[L],M=f(o,T,E);E.key===M.key;){if(W(E,M,e,r,i,L+1,v),L++,T++,L>k||T>w)break e;E=i[L],M=f(o,T,E),N=!0}for(S=i[k],$=f(o,w);S.key===$.key;){if(W(S,$,e,r,o,w+1,v),k--,w--,L>k||T>w)break e;S=i[k],$=f(o,w),N=!0}for(;E.key===$.key;){if(x=w+1<C?o[w+1]:v,W(E,$,e,r,null,0,x),u(e,$,x),L++,w--,L>k||T>w)break e;E=i[L],$=f(o,w),N=!0}for(;S.key===M.key;){if(x=L<y?i[L]:v,W(S,M,e,r,null,0,x),u(e,M,x),k--,T++,L>k||T>w)break e;S=i[k],M=f(o,T),N=!0}}var P;if(L>k)for(x=w+1<C?f(o,w+1):v,P=T;P<=w;P++)g(f(o,P),e,r,x);else if(T>w)H(e,i,L,k+1);else{var D,B=i[k+1],_={},q=0;for(P=k;P>=L;P--)m=i[P],D=m.key,m.next=B,void 0===D?(_[he+q]=m,q++):_[m.key]=m,B=m;for(x=w+1<C?f(o,w+1):v,P=w;P>=T;P--)p=o[P],D=p.key,void 0===D&&(q--,D=he+q),m=_[D],m?(_[D]=null,W(m,p,e,r,null,0,x),e.nextSibling!=(x&&x.dom)&&u(e,p,x)):g(p,e,r,x),x=p;for(P=L;P<=k;P++)m=i[P],D=m.key,null!==(void 0===D?_[he+q++]:_[D])&&I(e,m)}}}function B(e){e=K(e,this);var t=e.currentTarget,n=t.virtualNode.events[e.type];if(r(n)){for(var i=0,o=n.length;i<o;i++)if(U(n[i],t,e),pe){pe=!1;break}}else U(n,t,e)}function _(){return this.defaultPrevented}function q(){this.defaultPrevented=!0,this.returnValue=!1}function F(){this.cancelBubble=!0}function R(){pe=!0,this.stopPropagation()}function K(t,n){return t||(t=e.event,t.preventDefault||(t.preventDefault=q,t.stopPropagation=F,t.defaultPrevented=t.returnValue===!1,t.target=t.srcElement),t.currentTarget=n.nodeType?n:t.target),t.isDefaultPrevented||(t.isDefaultPrevented=_),t.stopImmediatePropagation=R,t}function U(e,t,n){try{e.handleEvent?e.handleEvent(n)===!1&&n.preventDefault():e.call(t,n)===!1&&n.preventDefault()}catch(r){ie.error(r.stack||r)}}function W(e,n,r,i,o,a,l,f){if(n!==e){var d=n.tag;if(e.tag!==d)g(n,r,i,e,!0);else{var s=e.dom,u=e.children,c=n.children;switch(d){case t:var v=o&&a<o.length?o[a]:l;z(e,u,n,c,r,i,v);break;case"#":case"!":u!==c&&(s.nodeValue=c),n.dom=s;break;case"<":u!==c?g(n,r,null,e,!0,f):(n.dom=e.dom,n.domLength=e.domLength);break;default:var h;e.key&&n.key!==e.key&&(h=e.events&&e.events.$destroyed,h&&m(h,"$destroyed",s,n));var p=n.attrs,b=e.attrs;if((p&&p.is)!==(b&&b.is))return void g(n,r,i,e,!0);var x=e.ns;x&&(n.ns=x),n.dom=s,c!==u&&D(s,n,x,u,c,!1);var y=n.events,C=e.events;if(p!==b){h=y&&y.$changed;var k=T(s,d,x,p,b,!!h);k&&m(h,"$changed",s,n,"changes",k)}y!==C&&S(s,n,y,C),void 0!==y&&void 0!==y.$subtreeModified&&m(y.$subtreeModified,"$subtreeModified",s,n)}}}}function z(e,t,n,i,o,a,l){if(i=d(n,i,t),i!==t){var f,s,u=V(i),v=V(t);if(a&&(n.ns=a),0===u)0===v?f=e.dom:(j(o,t,v),f=c(),h(o,f,l));else{if(0===v)return o.removeChild(e.dom),void L(n,i,o,a,l);if(D(o,n,a,t,i,!0,l),i=n.children,r(i)){f=i[0].dom,s=0;for(var g=0,m=i.length;g<m;g++)s+=i[g].domLength||1}else f=i.dom,s=i.domLength}n.dom=f,n.domLength=s}}function G(e){if(!n(e)){var r=e.dom;if(r){var i=e.events;if(i){for(var o in i)P(r,o);var a=i.$destroyed;a&&m(a,"$destroyed",r,e)}r.virtualNode&&(r.virtualNode=t)}var l=e.children;l&&J(l,V(l))}}function J(e,t){if(t>1)for(var n=0,r=e.length;n<r;n++)G(e[n]);else 0!==t&&G(s(e,t))}function Q(e,n){var r;for(r in e)n[r]=e[r];for(r in n)e[r]===t&&(n[r]=t)}function X(e){e&&e!=te.body&&e!=te.activeElement&&e.focus()}var Y,Z,ee={},te=e.document,ne=e.navigator,re=function(){},ie=e.console||{warn:re,error:re},oe=ne.userAgent,ae=oe.indexOf("WebKit")!==-1,le=oe.indexOf("Firefox")!==-1,fe=oe.indexOf("Trident")!==-1,de=te.createElement("div"),se="textContent"in te,ue="addEventListener"in te,ce="createRange"in te,ve="setProperty"in de.style,he="__UNDEF__:",ge=te.createElement("p");ge.insertAdjacentHTML&&(ge.appendChild(te.createTextNode("a")),ge.insertAdjacentHTML("beforeend","b"),Y=1===ge.childNodes.length,ge=te.createElement("p"),ge.appendChild(c()),ge.insertAdjacentHTML("beforeend","<b>"),Z=3!==ge.firstChild.nodeType);var me="",pe=(ce?te.createRange():null,!1);ee.vdom={create:function(e){return e=o(e),g(e),e},append:function(e,t){return t=o(t),g(t,e),t},update:function(e,t){var n=te.activeElement;return t=o(t,e),W(e,t,e.dom.parentNode),Q(t,e),X(n),e},updateChildren:function(e,t){var n=te.activeElement,r=e.children;r!==t&&D(e.dom,e,e.ns,r,t,!e.tag),X(n)},updateEvents:S,updateAttributes:T,remove:function(e){var t=e.dom.parentNode;I(t,e)}};return ee});